<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>รายละเอียดประกาศ - U-Nai Dee</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="logo">U-Nai Dee</div>
      <nav class="top-nav">
        <a id="loginLink" href="#" data-open-modal="login">เข้าสู่ระบบ</a>
        <a id="registerLink" href="#" data-open-modal="register">สมัครสมาชิก</a>
        <a id="landlordLink" href="landlord-dashboard.html" style="display:none">แดชบอร์ดผู้ปล่อยเช่า</a>
        <a id="adminLink" href="admin-dashboard.html" style="display:none">แดชบอร์ดแอดมิน</a>
        <span id="userStatus" class="user-status" style="display:none">
          <a class="user-name" href="profile.html"></a>
          <span class="user-role"></span>
          <button id="logoutBtn" type="button" class="btn-ghost">ออกจากระบบ</button>
        </span>
      </nav>
    </div>
  </header>

  <main>
    <div class="listing-shell">
      <a class="back-link" href="index.html">กลับหน้าค้นหา</a>
      <header class="listing-header">
        <h1 id="listingTitle">กำลังโหลด...</h1>
        <div class="listing-price" id="listingPrice"></div>
        <div class="listing-meta" id="listingMeta"></div>
      </header>
      <div id="listingLoading" class="loading-text" hidden>กำลังโหลดรายละเอียดประกาศ...</div>
      <div class="listing-layout">
        <section class="listing-gallery">
          <img id="listingHeroImage" class="listing-hero-image" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><rect width='100%25' height='100%25' fill='%23efefef'/><text x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-size='24'>Loading</text></svg>" alt="ภาพประกาศ" />
          <div id="listingThumbs" class="listing-thumbs"></div>
        </section>
        <aside class="listing-summary">
          <h2>ข้อมูลติดต่อ</h2>
          <ul id="contactList" class="contact-list"></ul>
          <div id="ownerInfo" class="listing-owner"></div>
          <div class="listing-actions">
            <button id="contactOwnerBtn" type="button" class="btn-primary btn-primary--full" data-requires-auth="true">ติดต่อสอบถาม</button>
            <button id="chatOwnerBtn" type="button" class="btn-outline btn-outline--full" data-requires-auth="true">แชทกับเจ้าของ</button>
            <button id="bookNowBtn" type="button" class="btn-accent btn-accent--full" data-requires-auth="true">กดจอง</button>
          </div>
        </aside>
      </div>
      <section class="listing-section">
        <h3>รายละเอียด</h3>
        <p id="listingDescription">กำลังโหลดรายละเอียด...</p>
      </section>
      <section class="listing-section">
        <h3>สิ่งอำนวยความสะดวก</h3>
        <div id="amenitiesList" class="amenities-grid"></div>
      </section>
      <section class="listing-section">
        <h3>ตำแหน่งที่ตั้ง</h3>
        <div id="listingDetailMap"></div>
      </section>
      <div class="listing-updated" id="listingUpdated"></div>
      <div id="listingError" class="error" hidden></div>
    </div>
  </main>

  <section id="contactModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-panel" role="document">
      <button type="button" class="modal-close" data-close aria-label="ปิดหน้าต่าง">✕</button>
      <h2>ติดต่อสอบถาม</h2>
      <p id="contactModalSummary">เลือกช่องทางติดต่อด้านล่างเพื่อคัดลอกหรือเปิดทันที</p>
      <div id="contactModalList" class="contact-modal-list"></div>
      <button type="button" class="btn-outline" data-close>ปิด</button>
    </div>
  </section>

  <section id="bookingModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-panel" role="document">
      <button type="button" class="modal-close" data-close aria-label="ปิดหน้าต่าง">✕</button>
      <h2>กดจอง</h2>
      <p>กรอกข้อมูลเพื่อติดต่อเจ้าของประกาศสำหรับการจอง</p>
      <form id="bookingForm" class="booking-form">
        <label class="field"><span>ชื่อของคุณ</span><input id="bookingName" type="text" required /></label>
        <label class="field"><span>อีเมล</span><input id="bookingEmail" type="email" required /></label>
        <label class="field"><span>เบอร์โทร</span><input id="bookingPhone" type="tel" /></label>
        <label class="field"><span>ข้อความเพิ่มเติม</span><textarea id="bookingMessage" rows="3" placeholder="แจ้งช่วงเวลาที่สะดวกหรือรายละเอียดอื่น ๆ"></textarea></label>
        <div id="bookingStatus" class="form-msg" aria-live="polite"></div>
        <button type="submit" class="btn-primary">ส่งคำขอจอง</button>
      </form>
    </div>
  </section>

  <aside id="authPanel" class="auth-panel" aria-hidden="true" aria-labelledby="authTitle">
    <button id="authClose" class="modal-close" aria-label="ปิดแบบฟอร์ม">✕</button>
    <div class="auth-inner">
      <div class="auth-tabs">
        <button id="tabLogin" class="auth-tab active" data-tab="login">เข้าสู่ระบบ</button>
        <button id="tabRegister" class="auth-tab" data-tab="register">สมัครสมาชิก</button>
      </div>
      <div id="authContent">
        <form id="panelLoginForm" class="auth-form" aria-hidden="false">
          <h3 id="authTitle">เข้าสู่ระบบ</h3>
          <label class="field"><span>อีเมล</span><input id="panelEmail" type="email" required /></label>
          <label class="field"><span>รหัสผ่าน</span>
            <div class="pwd-wrap"><input id="panelPassword" type="password" required /><button type="button" id="panelTogglePwd" class="icon-btn" aria-label="show password" title="แสดง/ซ่อนรหัสผ่าน"><svg class="icon-eye icon-eye-open" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M32 16C16 16 4 32 4 32s12 16 28 16 28-16 28-16-12-16-28-16Zm0 26a10 10 0 1 1 10-10 10 10 0 0 1-10 10Z" fill="#3DA5FF"/><circle cx="32" cy="32" r="6" fill="#fff"/></svg><svg class="icon-eye icon-eye-closed" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M8 8 56 56" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round"/><path d="M23 19a29 29 0 0 1 9-3c16 0 28 16 28 16a44 44 0 0 1-9 9" fill="none" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 24a44 44 0 0 0-8 8s12 16 28 16a30 30 0 0 0 8-1" fill="none" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>
          </label>
          <div class="row login-options" style="margin-top:8px">
            <label class="field checkbox" style="margin:0"><input id="rememberMe" type="checkbox" /> จดจำรหัสผ่าน</label>
            <a href="#" id="forgotLink" style="font-size:13px;color:#3DA5FF;text-decoration:none">ลืมรหัสผ่าน?</a>
          </div>
          <div id="panelLoginMsg" class="form-msg" aria-live="polite"></div>
          <button id="panelLoginBtn" type="submit" class="btn-primary">เข้าสู่ระบบ</button>
          <div id="passwordResetBox" style="display:none;margin-top:12px;padding:12px;border-radius:8px;background:#f8fbfd;border:1px solid #eef6fb">
            <div style="font-weight:600;margin-bottom:6px">รีเซ็ตรหัสผ่าน</div>
            <input id="resetEmail" type="email" placeholder="กรอกอีเมลสำหรับรีเซ็ต" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px" />
            <div style="display:flex;gap:8px"><button id="sendResetBtn" class="btn-primary" style="flex:1">ส่งลิงก์รีเซ็ต</button><button id="cancelResetBtn" class="btn-outline btn-sm" style="flex:0">ยกเลิก</button></div>
            <div id="resetMsg" class="form-msg" aria-live="polite"></div>
          </div>
        </form>

        <form id="panelRegisterForm" class="auth-form" aria-hidden="true">
          <h3>สมัครสมาชิก</h3>
          <label class="field"><span>ชื่อผู้ใช้</span><input id="regUsernamePanel" type="text" required /></label>
          <div class="two-cols">
            <label class="field"><span>เบอร์โทรศัพท์</span><input id="phone" type="tel" /></label>
            <label class="field"><span>อีเมล</span><input id="regEmailPanel" type="email" required /></label>
          </div>
          <label class="field"><span>รหัสผ่าน</span>
            <div class="pwd-wrap"><input id="regPasswordPanel" type="password" required /><button type="button" id="regPanelTogglePwd" class="icon-btn" aria-label="show password" title="แสดง/ซ่อนรหัสผ่าน"><svg class="icon-eye icon-eye-open" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M32 16C16 16 4 32 4 32s12 16 28 16 28-16 28-16-12-16-28-16Zm0 26a10 10 0 1 1 10-10 10 10 0 0 1-10 10Z" fill="#3DA5FF"/><circle cx="32" cy="32" r="6" fill="#fff"/></svg><svg class="icon-eye icon-eye-closed" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M8 8 56 56" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round"/><path d="M23 19a29 29 0 0 1 9-3c16 0 28 16 28 16a44 44 0 0 1-9 9" fill="none" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 24a44 44 0 0 0-8 8s12 16 28 16a30 30 0 0 0 8-1" fill="none" stroke="#3DA5FF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>
          </label>
          <label class="field"><span>ยืนยันรหัสผ่าน</span><input id="regPasswordConfirmPanel" type="password" required /></label>
          <div class="field">
            <span>ประเภทบัญชี</span>
            <div class="role-options" role="radiogroup" aria-label="เลือกประเภทผู้ใช้งาน">
              <label class="role-option"><input type="radio" name="regRole" value="customer" checked /><span>ลูกค้า</span></label>
              <label class="role-option"><input type="radio" name="regRole" value="landlord" /><span>ผู้ปล่อยเช่า</span></label>
            </div>
          </div>
          <div class="pw-hint">ต้องมีอย่างน้อย 8 ตัวอักษร มีตัวใหญ่ ตัวเล็ก และตัวเลข</div>
          <div id="panelRegMsg" class="form-msg" aria-live="polite"></div>
          <button id="panelRegisterBtn" type="submit" class="btn-primary">สมัครสมาชิก</button>
        </form>
      </div>
    </div>
  </aside>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <script src="app.js"></script>
  <script src="listing.js"></script>

  <!-- Chat Modal -->
  <div id="chatModal" class="modal" role="dialog" aria-labelledby="chatModalTitle" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content chat-modal">
      <header class="modal-header chat-header">
        <div class="chat-header-content">
          <h2 id="chatModalTitle">
            <svg class="chat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16Z" fill="currentColor"/>
              <path d="M7 9H17V11H7V9ZM7 12H15V14H7V12Z" fill="currentColor"/>
            </svg>
            กล่องข้อความ
          </h2>
          <div class="chat-status">
            <span class="status-dot online"></span>
            ออนไลน์
          </div>
        </div>
        <button type="button" class="modal-close chat-close-btn" data-close-modal aria-label="ปิดกล่องข้อความ">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </header>
      <div class="chat-container">
        <div class="chat-sidebar">
          <div class="sidebar-header">
            <h3>การสนทนา</h3>
            <div class="sidebar-actions">
              <button class="sidebar-action-btn" title="ค้นหาการสนทนา">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
          </div>
          <div id="conversationsList" class="conversations-list">
            <div class="conversations-loading">
              <div class="loading-spinner"></div>
              <span>กำลังโหลด...</span>
            </div>
          </div>
        </div>
        <div class="chat-main">
          <div class="chat-main-header">
            <div id="currentConversationInfo" class="conversation-info">
              <div class="conversation-avatar">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="currentColor"/>
                </svg>
              </div>
              <div class="conversation-details">
                <div class="conversation-name">เลือกการสนทนา</div>
                <div class="conversation-status">คลิกที่การสนทนาเพื่อเริ่มแชท</div>
              </div>
            </div>
          </div>
          <div id="chatMessages" class="chat-messages">
            <div class="chat-empty-state">
              <div class="empty-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16Z" fill="currentColor"/>
                </svg>
              </div>
              <h4>เริ่มการสนทนา</h4>
              <p>เลือกการสนทนาจากด้านซ้ายหรือเริ่มสนทนาใหม่</p>
            </div>
          </div>
          <form id="chatForm" class="chat-form">
            <div class="chat-input-container">
              <div class="chat-input-group">
                <input type="text" id="chatMessage" placeholder="พิมพ์ข้อความของคุณที่นี่..." autocomplete="off" />
                <button type="button" class="chat-attach-btn" id="chatAttachmentBtn" title="แนบไฟล์รูปภาพ">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.5 6V17.5C16.5 19.71 14.71 21.5 12.5 21.5C10.29 21.5 8.5 19.71 8.5 17.5V5C8.5 3.62 9.62 2.5 11 2.5C12.38 2.5 13.5 3.62 13.5 5V15.5C13.5 16.05 13.05 16.5 12.5 16.5C11.95 16.5 11.5 16.05 11.5 15.5V6H10V15.5C10 17.16 11.34 18.5 13 18.5C14.66 18.5 16 17.16 16 15.5V5C16 2.79 14.21 1 12 1S8 2.79 8 5V17.5C8 20.54 10.46 23 13.5 23C16.54 23 19 20.54 19 17.5V6H16.5Z" fill="currentColor"/>
                  </svg>
                </button>
              </div>
              <input type="file" id="chatAttachmentInput" accept="image/*" hidden />
              <div id="chatAttachmentPreview" class="chat-attachment-preview" hidden>
                <div class="attachment-chip">
                  <div class="attachment-thumb" id="chatAttachmentThumb" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16.5 6V17.5C16.5 19.71 14.71 21.5 12.5 21.5C10.29 21.5 8.5 19.71 8.5 17.5V5C8.5 3.62 9.62 2.5 11 2.5C12.38 2.5 13.5 3.62 13.5 5V15.5C13.5 16.05 13.05 16.5 12.5 16.5C11.95 16.5 11.5 16.05 11.5 15.5V6H10V15.5C10 17.16 11.34 18.5 13 18.5C14.66 18.5 16 17.16 16 15.5V5C16 2.79 14.21 1 12 1S8 2.79 8 5V17.5C8 20.54 10.46 23 13.5 23C16.54 23 19 20.54 19 17.5V6H16.5Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <span id="chatAttachmentName" class="attachment-name"></span>
                  <button type="button" class="attachment-remove" id="chatAttachmentRemove" aria-label="ยกเลิกไฟล์">✕</button>
                </div>
              </div>
              <div id="chatFormMsg" class="form-msg" aria-live="polite"></div>
              <button type="button" id="chatSendBtn" class="btn-send">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="currentColor"/>
                </svg>
                ส่ง
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

